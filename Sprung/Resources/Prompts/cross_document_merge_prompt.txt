# Cross-Document Card Merge

You have card inventories from multiple documents. Merge related cards to create a balanced, manageable set while preserving important distinctions.

## All Document Inventories

{INVENTORIES_JSON}

## Timeline (for employment context)

{TIMELINE_JSON}

---

## Your Task

1. **Merge related cards** when they cover the same topic or domain
2. **Keep cards separate** when they represent genuinely distinct experiences
3. **Designate primary source** for each merged card
4. **Preserve key evidence** from supporting documents
5. **Identify gaps** where cards have weak evidence

## Merge Rules - BALANCED APPROACH

### Employment Cards
- ONE card per employer/organization
- Multiple roles at same org → consolidate into one card with role progression
- Include key projects as bullet points within the employment card

### Skill Cards
- Group closely related skills into domain cards
- Example: "Python", "FastAPI", "SQLAlchemy" → ONE "Python Backend Development" card
- Keep separate when skills serve different domains (e.g., "Python for Data Science" vs "Python for Web")

### Project Cards
- Create separate cards only for MAJOR standalone projects
- Smaller projects → include in employment or skill cards
- Related projects at same employer → consolidate

### Achievement Cards
- Group related achievements (e.g., all teaching awards → one card)
- Keep separate for truly distinct recognition types

### Education Cards
- ONE card per degree/institution
- Group related certifications by domain

## Target Card Counts

Target 35-50 cards for a typical professional with 10+ years experience:
- 4-7 employment cards (one per major employer/role)
- 5-10 project cards (major standalone projects only)
- 15-25 skill cards (grouped by domain)
- 3-6 achievement cards (grouped by category)
- 2-4 education cards

Balance is key: preserve meaningful distinctions while avoiding redundancy.

## Output Format

```json
{
  "generated_at": "2024-01-15T10:30:00Z",
  "merged_cards": [
    {
      "card_id": "uuid",
      "card_type": "skill",
      "title": "Industrial Automation & Embedded Control",
      "primary_source": {
        "document_id": "huntsville_report",
        "evidence_locations": ["pages 1-17"]
      },
      "supporting_sources": [
        {
          "document_id": "git_repos_nrd",
          "evidence_locations": ["full codebase analysis"],
          "adds": ["Teensy implementation details", "I2C protocol design"]
        }
      ],
      "combined_key_facts": ["...all unique facts, max 5..."],
      "combined_technologies": ["...max 5..."],
      "combined_outcomes": ["...max 3..."],
      "date_range": "2017-present",
      "evidence_quality": "strong|moderate|weak",
      "extraction_priority": "high|medium|low"
    }
  ],

  "gaps": [
    {
      "card_title": "Senior Lecturer, Cal Poly",
      "gap_type": "missing_primary_source",
      "current_evidence": "Resume bullet only",
      "recommended_docs": ["performance reviews", "teaching evaluations"]
    }
  ],

  "stats": {
    "total_input_cards": 87,
    "merged_output_cards": 42,
    "cards_by_type": {"employment": 5, "skill": 20, "project": 8, "achievement": 5, "education": 4},
    "strong_evidence": 30,
    "needs_more_evidence": 12
  }
}
```

Return ONLY valid JSON.
